<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Área do Aluno</title>
  <style>
    :root{
      --bg:#0b0d12;
      --card:#121624;
      --muted:#9aa4b2;
      --text:#eef2ff;
      --accent:#ff7a18;
      --accent2:#ffb020;
      --ok:#3ddc97;
      --danger:#ff4d4d;
      --border: rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 15% 10%, rgba(255,122,24,.18), transparent 60%),
                  radial-gradient(1000px 600px at 85% 10%, rgba(255,176,32,.14), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--border);border-radius:var(--radius);
      background: rgba(18,22,36,.65); backdrop-filter: blur(10px); box-shadow: var(--shadow);
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 25px rgba(255,122,24,.22);
    }
    .brand h1{font-size:16px;margin:0}
    .brand p{margin:0;color:var(--muted);font-size:12px}
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      cursor:pointer;
      transition:.2s ease;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.09)}
    .btn.primary{
      border:0;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#10131c;
      font-weight:700;
    }
    .grid{
      display:grid;grid-template-columns: 360px 1fr; gap:18px; margin-top:18px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background: rgba(18,22,36,.65);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-h{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid var(--border);
    }
    .card-h h2{margin:0;font-size:14px}
    .card-h small{color:var(--muted)}
    .card-b{padding:14px 16px}
    .login{
      max-width:520px;margin:40px auto 0;
    }
    .login .card-b{padding:18px}
    .field{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      outline:none;
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-size:14px;
    }
    .hint{color:var(--muted);font-size:12px;line-height:1.4;margin-top:10px}
    .error{color:var(--danger);font-size:13px;margin-top:10px;display:none}
    .ok{color:var(--ok);font-size:13px;margin-top:10px;display:none}
    .module{
      border:1px solid var(--border);
      border-radius:16px;
      background: rgba(255,255,255,.04);
      overflow:hidden;
      margin-bottom:12px;
    }
    .module summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      user-select:none;
    }
    .module summary::-webkit-details-marker{display:none}
    .module-title{display:flex;flex-direction:column;gap:2px}
    .module-title b{font-size:13px}
    .module-title span{font-size:12px;color:var(--muted)}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      white-space:nowrap;
    }
    .lesson{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:10px 12px;
      border-top:1px solid var(--border);
      cursor:pointer;
      transition:.15s ease;
    }
    .lesson:hover{background: rgba(255,255,255,.05)}
    .lesson-left{display:flex;flex-direction:column;gap:2px}
    .lesson-left .t{font-size:13px}
    .lesson-left .m{font-size:12px;color:var(--muted)}
    .lesson-right{display:flex;align-items:center;gap:8px}
    .dot{
      width:10px;height:10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.06);
    }
    .dot.done{background: var(--ok); border-color: transparent}
    .player{
      aspect-ratio: 16/9;
      width:100%;
      border:0;
      border-radius:16px;
      background:#000;
    }
    .meta{
      display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; align-items:center;
    }
    .meta .chip{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;color:var(--muted);
    }
    .row{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px;
    }
    .progress{
      height:10px;
      background: rgba(255,255,255,.08);
      border-radius:999px;
      overflow:hidden;
      border:1px solid var(--border);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      transition:.25s ease;
    }
    .small{font-size:12px;color:var(--muted)}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1 id="courseName">Seu Curso</h1>
          <p id="courseSub">Área do aluno</p>
        </div>
      </div>

      <div style="display:flex; gap:10px; align-items:center">
        <button class="btn" id="resetProgressBtn" title="Apaga o progresso salvo nesse navegador">Zerar progresso</button>
        <button class="btn" id="logoutBtn">Sair</button>
      </div>
    </div>

    <!-- LOGIN -->
    <div class="login" id="loginView">
      <div class="card">
        <div class="card-h">
          <h2>Entrar</h2>
          <small>Digite a senha que você recebeu</small>
        </div>
        <div class="card-b">
          <div class="field">
            <label for="pw" class="small">Senha de acesso</label>
            <input id="pw" type="password" placeholder="Ex: ALUNO2026" autocomplete="off" />
          </div>
          <div class="row">
            <button class="btn primary" id="loginBtn">Acessar aulas</button>
            <span class="small" id="capsHint" style="display:none;">Caps Lock ligado</span>
          </div>
          <div class="error" id="loginError">Senha incorreta. Tente de novo.</div>
          <div class="ok" id="loginOk">Liberado ✅</div>
          <div class="hint">
            Dica: se você for hospedar isso e mandar o link pro cliente, fica mais organizado e “cara de plataforma”.
          </div>
        </div>
      </div>
    </div>

    <!-- APP -->
    <div class="grid hidden" id="appView">
      <div class="card">
        <div class="card-h">
          <h2>Módulos e aulas</h2>
          <small id="countInfo">0 aulas</small>
        </div>
        <div class="card-b" id="modules"></div>
      </div>

      <div class="card">
        <div class="card-h">
          <h2 id="lessonTitle">Selecione uma aula</h2>
          <small id="lessonMeta">—</small>
        </div>
        <div class="card-b">
          <iframe id="player" class="player" src="" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

          <div class="meta">
            <div class="chip" id="moduleChip">Módulo: —</div>
            <div class="chip" id="lessonChip">Aula: —</div>
            <div class="chip" id="progressChip">Progresso: 0%</div>
          </div>

          <div class="row">
            <button class="btn primary" id="doneBtn">Marcar como concluída</button>
            <button class="btn" id="copyLinkBtn" title="Copia um link direto para essa aula (funciona quando hospedado)">Copiar link da aula</button>
            <span class="small" id="copyMsg"></span>
          </div>

          <div style="margin-top:14px">
            <div class="small" style="margin-bottom:8px">Progresso nesse navegador</div>
            <div class="progress"><div class="bar" id="bar"></div></div>
          </div>

          <div class="hint">
            Obs: “concluída” e progresso ficam salvos no navegador do aluno. Se ele trocar de aparelho/navegador, zera.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/**
 * ========= CONFIGURAÇÃO =========
 * 1) Defina sua senha aqui:
 */
const ACCESS_PASSWORD = "Vip2026";

/**
 * 2) Defina seu curso + módulos/aulas aqui.
 * Para YouTube, use o ID do vídeo (o que vem depois de v=).
 * Ex: https://www.youtube.com/watch?v=dQw4w9WgXcQ  -> id: "dQw4w9WgXcQ"
 */
const COURSE = {
  name: "Seu Curso",
  subtitle: "Bem-vindo(a)! Bons estudos.",
  modules: [
    {
      title: "Módulo 1 — Começando",
      lessons: [
        { title: "Aula 01 — Boas-vindas", provider: "youtube", id: "f7noTXvepQ4" },
        { title: "Aula 02 — Configuração", provider: "youtube", id: "dQw4w9WgXcQ" },
      ]
    },
    {
      title: "Módulo 2 — Parte prática",
      lessons: [
        { title: "Aula 01 — Primeira prática", provider: "youtube", id: "dQw4w9WgXcQ" },
      ]
    }
  ]
};

/**
 * ========= LÓGICA =========
 */
const LS = {
  authed: "curso_authed",
  progress: "curso_progress_v1",
  lastLesson: "curso_last_lesson_v1"
};

const $ = (id) => document.getElementById(id);

const loginView = $("loginView");
const appView = $("appView");
const pw = $("pw");
const loginBtn = $("loginBtn");
const loginError = $("loginError");
const loginOk = $("loginOk");
const logoutBtn = $("logoutBtn");
const resetProgressBtn = $("resetProgressBtn");

const modulesEl = $("modules");
const player = $("player");
const lessonTitle = $("lessonTitle");
const lessonMeta = $("lessonMeta");
const moduleChip = $("moduleChip");
const lessonChip = $("lessonChip");
const progressChip = $("progressChip");
const bar = $("bar");
const doneBtn = $("doneBtn");
const copyLinkBtn = $("copyLinkBtn");
const copyMsg = $("copyMsg");
const countInfo = $("countInfo");

$("courseName").textContent = COURSE.name;
$("courseSub").textContent = COURSE.subtitle;

function getAllLessons(){
  const all = [];
  COURSE.modules.forEach((m, mi) => {
    m.lessons.forEach((l, li) => all.push({ ...l, moduleIndex: mi, lessonIndex: li }));
  });
  return all;
}

function keyFor(mi, li){ return `m${mi}_l${li}`; }

function loadProgress(){
  try { return JSON.parse(localStorage.getItem(LS.progress) || "{}"); }
  catch { return {}; }
}
function saveProgress(obj){
  localStorage.setItem(LS.progress, JSON.stringify(obj));
}

function isAuthed(){
  return localStorage.getItem(LS.authed) === "1";
}
function setAuthed(v){
  localStorage.setItem(LS.authed, v ? "1" : "0");
}

function ytEmbed(id){
  return `https://www.youtube.com/embed/${encodeURIComponent(id)}?rel=0&modestbranding=1`;
}

function setCurrentLesson(mi, li){
  const mod = COURSE.modules[mi];
  const lesson = mod.lessons[li];
  const src = (lesson.provider === "youtube") ? ytEmbed(lesson.id) : lesson.url;

  player.src = src;

  lessonTitle.textContent = lesson.title;
  lessonMeta.textContent = `${mod.title}`;
  moduleChip.textContent = `Módulo: ${mi+1}`;
  lessonChip.textContent = `Aula: ${li+1}`;

  localStorage.setItem(LS.lastLesson, JSON.stringify({ mi, li }));
  highlightSelected(mi, li);
  updateProgressUI();
}

function highlightSelected(mi, li){
  document.querySelectorAll("[data-lesson]").forEach(el => el.style.outline = "none");
  const sel = document.querySelector(`[data-lesson="${keyFor(mi, li)}"]`);
  if(sel) sel.style.outline = "2px solid rgba(255,122,24,.55)";
}

function renderModules(){
  modulesEl.innerHTML = "";
  const all = getAllLessons();
  countInfo.textContent = `${all.length} aulas`;

  const progress = loadProgress();

  COURSE.modules.forEach((m, mi) => {
    const details = document.createElement("details");
    details.className = "module";
    details.open = mi === 0;

    const doneCount = m.lessons.filter((_, li) => progress[keyFor(mi, li)]).length;

    const summary = document.createElement("summary");
    summary.innerHTML = `
      <div class="module-title">
        <b>${m.title}</b>
        <span>${m.lessons.length} aulas • ${doneCount} concluídas</span>
      </div>
      <span class="pill">${doneCount}/${m.lessons.length}</span>
    `;

    details.appendChild(summary);

    m.lessons.forEach((l, li) => {
      const row = document.createElement("div");
      row.className = "lesson";
      row.dataset.lesson = keyFor(mi, li);

      const done = !!progress[keyFor(mi, li)];

      row.innerHTML = `
        <div class="lesson-left">
          <div class="t">${l.title}</div>
          <div class="m">Clique para assistir</div>
        </div>
        <div class="lesson-right">
          <div class="dot ${done ? "done" : ""}"></div>
        </div>
      `;

      row.addEventListener("click", () => setCurrentLesson(mi, li));
      details.appendChild(row);
    });

    modulesEl.appendChild(details);
  });
}

function updateProgressUI(){
  const all = getAllLessons();
  const progress = loadProgress();
  const done = all.filter(l => progress[keyFor(l.moduleIndex, l.lessonIndex)]).length;
  const pct = all.length ? Math.round((done / all.length) * 100) : 0;
  progressChip.textContent = `Progresso: ${pct}%`;
  bar.style.width = pct + "%";

  // Re-render dots and module counts
  document.querySelectorAll("[data-lesson]").forEach(el => {
    const k = el.dataset.lesson;
    const dot = el.querySelector(".dot");
    if(dot) dot.classList.toggle("done", !!progress[k]);
  });

  // Update module badges text (quick approach: rerender headers)
  document.querySelectorAll(".module").forEach((modEl, mi) => {
    const m = COURSE.modules[mi];
    const doneCount = m.lessons.filter((_, li) => progress[keyFor(mi, li)]).length;
    const span = modEl.querySelector(".pill");
    const sub = modEl.querySelector(".module-title span");
    if(span) span.textContent = `${doneCount}/${m.lessons.length}`;
    if(sub) sub.textContent = `${m.lessons.length} aulas • ${doneCount} concluídas`;
  });
}

function showApp(){
  loginView.classList.add("hidden");
  appView.classList.remove("hidden");
  renderModules();

  // abre aula do link (?aula=m0_l0) se existir
  const params = new URLSearchParams(location.search);
  const aula = params.get("aula");
  if(aula){
    const match = aula.match(/^m(\d+)_l(\d+)$/);
    if(match){
      const mi = Number(match[1]), li = Number(match[2]);
      if(COURSE.modules[mi] && COURSE.modules[mi].lessons[li]){
        setCurrentLesson(mi, li);
        return;
      }
    }
  }

  // senão, última aula vista
  const last = localStorage.getItem(LS.lastLesson);
  if(last){
    try{
      const { mi, li } = JSON.parse(last);
      if(COURSE.modules[mi] && COURSE.modules[mi].lessons[li]){
        setCurrentLesson(mi, li);
        return;
      }
    }catch{}
  }

  // padrão
  setCurrentLesson(0, 0);
}

function showLogin(){
  loginView.classList.remove("hidden");
  appView.classList.add("hidden");
  pw.value = "";
}

loginBtn.addEventListener("click", () => {
  loginError.style.display = "none";
  loginOk.style.display = "none";

  if(pw.value === ACCESS_PASSWORD){
    setAuthed(true);
    loginOk.style.display = "block";
    showApp();
  }else{
    loginError.style.display = "block";
  }
});

pw.addEventListener("keydown", (e) => {
  if(e.key === "Enter") loginBtn.click();
});

pw.addEventListener("keyup", (e) => {
  $("capsHint").style.display = e.getModifierState && e.getModifierState("CapsLock") ? "inline" : "none";
});

logoutBtn.addEventListener("click", () => {
  setAuthed(false);
  showLogin();
});

resetProgressBtn.addEventListener("click", () => {
  localStorage.removeItem(LS.progress);
  updateProgressUI();
  renderModules();
});

doneBtn.addEventListener("click", () => {
  const last = localStorage.getItem(LS.lastLesson);
  if(!last) return;
  const { mi, li } = JSON.parse(last);
  const k = keyFor(mi, li);
  const progress = loadProgress();
  progress[k] = true;
  saveProgress(progress);
  updateProgressUI();
});

copyLinkBtn.addEventListener("click", async () => {
  const last = localStorage.getItem(LS.lastLesson);
  if(!last) return;

  const { mi, li } = JSON.parse(last);
  const url = new URL(location.href);
  url.searchParams.set("aula", keyFor(mi, li));

  try{
    await navigator.clipboard.writeText(url.toString());
    copyMsg.textContent = "Link copiado ✅";
  }catch{
    copyMsg.textContent = "Não consegui copiar (bloqueado pelo navegador).";
  }
  setTimeout(()=> copyMsg.textContent="", 2000);
});

(function init(){
  if(isAuthed()){
    showApp();
  }else{
    showLogin();
  }
})();
</script>
</body>
</html>
